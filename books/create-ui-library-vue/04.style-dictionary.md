---
title: 'Style Dictionaryを使ったデザイントークンの管理'
---

## style-dictionaryとは

todo

## デザイントークンライブラリのセットアップ

最初に作ったリポジトリの中に、新規でリポジトリを作ります。ついでに最低限必要な設定も済ませておきます。

```zsh:zsh
  mkdir -p./packages/design-tokens
  cd ./packages/design-tokens
  pnpm init
  pnpm add -D style-dictionary
  pnpm style-dictionary init basic
  pnpm pkg set scripts.build="style-dictionary build"
  echo "build" > ./.gitignore
```

上記で作成したリポジトリのディレクトリ構成は以下のようになります。`tokens/*.json` がビルド対象のデザイントークンです。

<!-- prettier-ignore-start -->
```markdown
packages
└── design-tokens
    ├── tokens
    │   ├── colors.json
    │   ├── dimensions.json
    │   ├── object-values.json
    │   └── text.json
    ├── .gitignore
    ├── config.json
    ├── package.json
    ├── pnpm-lock.yaml
    └── README.md
```
<!-- prettier-ignore-end -->

次に `config.json` を用途に合わせて一部修正します。このファイルでstyle-dictionaryのビルド時の出力先のプラットフォームやフォーマット、トークンの変換処理を設定します。
本記事では `tailwind.config.js` からimportすることを前提としているため、FormatをESM(ECMAScriptモジュール)に限定します。

[Configuration | Style Dictionary](https://v4.styledictionary.com/reference/config/)

```json:packages/design-tokens/config.json
{
  "source": ["tokens/**/*.json"],
  "platforms": {
    "js": {
      "transformGroup": "js",
      "buildPath": "build/js/",
      "files": [
        {
          "destination": "variables.js",
          "format": "javascript/esm",
          "options": {
            "minify": true
          }
        }
      ]
    }
  }
}
```

設定したら `pnpm run build` でデザイントークンをビルドしてみましょう。`build/js/variables.js` にESMに変換されたデザイントークンファイルが生成されます。

<!-- prettier-ignore-start -->
![built-tokens](/images/create-ui-library-vue/built-tokens.png =400x)
*生成されたデザイントークンのJSファイル*
<!-- prettier-ignore-end -->

実際に `tailwind.config.js` からビルドしたトークンを引き込んでスタイルを適用してみましょう。
かなり行儀が悪いですが今回は `packages/design-tokens/build/` のJSファイルを直接参照します。名称はわかりやすく `custom-orange` にしておきます。

```diff javascript:tailwind.config.js
 import colors from "tailwindcss/colors";
+import tokens from "./packages/design-tokens/build/js/variables";

/** @type {import('tailwindcss').Config} */
 export default {
   content: ["./index.html", "./src/**/*.{vue,js,ts,jsx,tsx}"],
   theme: {
     colors: {
       transparent: "transparent",
       current: "currentColor",
       black: colors.black,
       white: colors.white,
       gray: colors.gray,
+      "custom-orange": tokens.colors.orange,
       primary: {
         DEFAULT: "#0054e9",
         contrast: "#ffffff",
         shade: "#004acd",
         tint: "#1a65eb",
       },
       secondary: {
         DEFAULT: "#0163aa",
         contrast: "#ffffff",
         shade: "#015796",
         tint: "#1a73b3",
       },
     },
     extend: {},
   },
   plugins: [],
 };
```

これでUtility Classesから `orange` のObjectが使えるようになりました🍊
早速 `ButtonBase.vue` にcolorを追加し、 `App.vue` から `color: "orange"` を渡してみましょう。

```diff vue:src/components/ButtonBase.vue
 <script setup lang="ts">
 import { computed } from "vue";

 interface Props {
   /** @default 'primary' */
-  color?: "primary" | "secondary";
+  color?: "primary" | "secondary" | "orange";
   /** @default 'medium' */
   size?: "small" | "medium" | "large";
 }

 const props = withDefaults(defineProps<Props>(), {
   color: "primary",
   size: "medium",
 });

 const emit = defineEmits<{
   (e: "click", payload: MouseEvent): void;
 }>();

 defineOptions({
   inheritAttrs: false,
 });

 const classes = computed<string[]>(() => {
   return [
     props.color === "secondary"
       ? "bg-secondary text-secondary-contrast"
+      : props.color === "orange"
+       ? "bg-custom-orange-600 text-custom-orange-100"
       : "bg-primary text-primary-contrast",
// ...
```

```diff vue:src/App.vue
 <script setup lang="ts">
 import ButtonBase from "./components/ButtonBase.vue";
 </script>

 <template>
   <div class="flex flex-col gap-y-2 p-4">
     <div class="flex items-center gap-x-2">
+      <ButtonBase color="orange">Orange 🍊</ButtonBase>
       <ButtonBase>Primary Default</ButtonBase>
       <ButtonBase disabled>Primary Disabled</ButtonBase>
       <ButtonBase size="small">Primary Small</ButtonBase>
       <ButtonBase size="large">Primary Large</ButtonBase>
     </div>
```

<!-- prettier-ignore-start -->
![button-color-orange](/images/create-ui-library-vue/button-color-orange.png =800x)
*しっかりオレンジ色です🍊*
<!-- prettier-ignore-end -->

### npm packageとしてinstallするための準備

デザイントークンをJavaScriptライブラリとして使う場合、 `pnpm add design-tokens` のような形で外から引き込めるのが望ましいです。
package.jsonでESMパッケージ用のエントリーポイントを設定しましょう。

```diff json:packages/design-tokens/package,json
 {
   "name": "design-tokens",
   "version": "1.0.0",
+  "type": "module",
   "description": "",
-  "main": "index.js",
+  "exports": "./build/js/variables.js",
+  "module": "./build/js/variables.js",
   "scripts": {
     "test": "echo \"Error: no test specified\" && exit 1",
     "build": "style-dictionary build"
   },
   "keywords": [],
   "author": "",
   "license": "ISC",
   "devDependencies": {
     "style-dictionary": "^4.3.0"
   }
 }
```

### pnpm workspaceで親→子へのAliasを作る

ようやくここでpnpmの出番です。 [pnpm workspace](https://pnpm.io/workspaces)を使ってmonorepoのlinkを簡単に設定できます。
リポジトリのrootに `pnpm-workspace.yaml` を作って `packages/*` のリポジトリをnpm packageとしてinstallできるようにしましょう。

```zsh:zsh
  rm ./packages/design-tokens/pnpm-lock.yaml
  echo "packages:\n  - \"packages/*\"" > ./pnpm-workspace.yaml
```

```diff json:package.json
 {
   "name": "hands-on-app",
   "private": true,
   "version": "0.0.0",
   "type": "module",
   "scripts": {
     "dev": "vite",
     "build": "vue-tsc -b && vite build",
     "preview": "vite preview",
+    "build:design-tokens": "pnpm --filter design-tokens build",
   },
   "dependencies": {
+    "design-tokens": "workspace:*",
# ...
```

ざっくり設定は完了です。`pnpm build:design-tokens && pnpm install` で `node_modules/design-tokens` が含まれているのを確認しましょう。最後に `tailwind.config.js` の参照をAliasの `design-tokens` に向け直します。

```diff javascript:tailwind.config.js
+import tokens from "design-tokens";
 import colors from "tailwindcss/colors";
-import tokens from "./packages/design-tokens/build/js/variables";
```

これでデザイントークンライブラリをnpm package化して別のリポジトリからinstallするところまで実施できました。
最後に `pnpm run dev` でさっきと同じくオレンジ色のButtonBaseが表示されればOKです🙆

## まとめ
